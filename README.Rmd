---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

## The `BayesMFSurv` package

_Minnie M. Joo, Sergio Bejar, Nicolas Schmidt, Bumba Mukherjee_

<!-- badges: start -->
[![CRAN\_Status\_Badge](https://www.r-pkg.org/badges/version/BayesMFSurv)](https://cran.r-project.org/package=BayesMFSurv)
[![CRAN RStudio mirrordownloads](https://cranlogs.r-pkg.org/badges/BayesMFSurv?color=brightgreen)](https://www.r-pkg.org/pkg/BayesMFSurv)
<!-- badges: end -->


### Description

Contains a split population survival estimator that models the misclassification probability of failure versus right-censored events. The split population survival estimator is described in Bagozzi et al. (2019) <doi:10.1017/pan.2019.6>.

### Installation

You can install the released version (`0.1.0`) of `BayesMFSurv` from [CRAN](https://cran.r-project.org/) with:

``` r
install.packages("BayesMFSurv")
```

And the development version (`0.2.0`) from GitHub with:

``` r
if (!require("remotes")) install.packages("remotes")
remotes::install_github("Nicolas-Schmidt/BayesMFSurv")
```

## Functions


| Function |Description |
| ----------------- | -------------------------------------------------------------- | 
|`mfsurv`|fits a parametric Bayesian MF model via Markov Chain Monte Carlo (MCMC) to estimate the probability of misclassification in the first stage and the hazard in the second stage.|
|`mfsurv.stats`|a function to calculate the deviance information criterion (DIC) for fitted model objects of class mfsurv|
|`mfsurv.summary`|returns a summary of a mfsurv object via `coda::summary.mcmc`|
|`betas.post2`|log-posterior distribution of betas with pth element fixed as betas.p|
|`betas.slice.sampling2`|slice sampling for betas|
|`univ.betas.slice.sampling2`|univariate slice sampling for betas.p|
|`gammas.post2`|log-posterior distribution of gammas with pth element fixed as gammas.p|
|`gammas.slice.sampling2`|slice sampling for gammas|
|`univ.gammas.slice.sampling2`|univariate slice sampling for gammas.p|
|`lambda.post2`|log-posterior distribution of lambda|
|`lambda.slice.sampling2`|univariate slice sampling for lambda|
|`mcmcsurv` | estimates a Bayesian Exponential or Weibull survival model via Markov Chain Monte Carlo (MCMC)




### Example


The data used to estimate the following examples come from Reenock, Bernhard and Sobek (2007) -DOI: 10.111/j.1468-2478.2007.00469.x-.  The RBS (2007) dataset uses continuous-time event history techniques to code episodes of democratic breakdown in all democracies from 1961 to 1995.  In addition, it provides data on a number of economic and political variables. 

|Variable| Description|
| ----------------- | -------------------------------------------------------------- | 
|__calinv__|inverse of per capita daily caloric supply|
|__lnlevel__|natural log of economic development|
|__calileve__|inverse of per capita daily caloric supply*natural log of economic development|
|__necon__|economic performance|
|__presi__|presidential regime|
|__tag__|effective number of parties|
|__rel__|religious fractionalization|
|__ethn__|ethnic fractionalization|
|__prevdem__|numbers of previous democratic episodes|
|__openc__|trade openness|
|__Y__|years in current democratic episode |
|__Y0__|years in current democratic episode (lagged)|
|__C__|breakdown of democratic episode|


#### Misclassified-Failure
```{r example, eval = FALSE}
library(BayesMFSurv)

# Baseline Bayesian misclassified failure (MF) model. 
# Misclassification stage only includes the intercept while the survival stage 
# includes all covariates described above.  

library(BayesMFSurv)

set.seed(95)
RBS <- na.omit(RBS)
Y   <- RBS$Y
X   <- as.matrix(cbind(1, RBS[,1:10]))
C   <- RBS$C
Z1  <- cbind(rep(1,nrow(RBS)))
Y0  <- RBS$Y0
model1 <- mfsurv(Y ~ X | C ~ Z1, Y0 = Y0,
                 N = 100000,
                 burn = 10000,
                 thin = 100,
                 w = c(0.5, .5, .5),
                 m = 20,
                 form = "Weibull",
                 na.action = 'na.omit')

```{r, echo = FALSE}
library(BayesMFSurv)
model1 <- rio::import(here::here("data-raw", "rbs.model1_betas.rds"))
```

```{r}
mfsurv.stats(model1)

mfsurv.summary(model1, parameter = c("betas"))
```

#### Non Misclassified-Failure
```{r, eval = FALSE}
model2 <- mcmcSurv(Y = Y, Y0 = Y0, C =  C,  X = X, 
                   N = 5000, 
                   burn = 500, 
                   thin = 5, 
                   w = c(0.5, 0.5, 0.5),
                   m = 10, 
                   form = "Weibull")

```

```{r, echo = FALSE}
model2 <- rio::import(here::here("data-raw", "nonmf.rds"))
```


```{r}
str(model2)
```


```{r, echo = FALSE}
par(mfrow = c(3,4))
for(i in 1:ncol(model2$betas)){
    plot(density(model2$betas[,i]), main = i, ylab = "")}
par(mfrow = c(3,4))
for(i in 1:ncol(model2$betas)){plot(model2$betas[,i], type = 'l', ylab = "", xlab = "", main = i)}
```






#### Citation

To cite package`BayesMFSurv` in publications, please use:

```r
citation(package = 'BayesMFSurv')
```



