---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

## The `BayesMFSurv` package

_Minnie M. Joo, Nicolas Schmidt, Sergio Bejar, Bumba Mukherjee, Vineeta Yadav_

<!-- badges: start -->
[![CRAN\_Status\_Badge](https://www.r-pkg.org/badges/version/BayesMFSurv)](https://cran.r-project.org/package=BayesMFSurv)
[![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![CRAN RStudio mirrordownloads](https://cranlogs.r-pkg.org/badges/grand-total/BayesMFSurv?color=blue)](https://www.r-pkg.org/pkg/BayesMFSurv)
[![CRAN RStudio mirrordownloads](https://cranlogs.r-pkg.org/badges/BayesMFSurv?color=blue)](https://www.r-pkg.org/pkg/BayesMFSurv)
<!-- badges: end -->


### Description

Contains a split population survival estimator that models the misclassification probability of failure versus right-censored events. The split population survival estimator is described in Bagozzi et al. (2019) <doi:10.1017/pan.2019.6>.

### Installation

You can install the released version (`0.1.0`) of `BayesMFSurv` from [CRAN](https://cran.r-project.org/) with:

``` r
install.packages("BayesMFSurv")
```

And the development version (`0.2.0`) from GitHub with:

``` r
if (!require("remotes")) install.packages("remotes")
remotes::install_github("Nicolas-Schmidt/BayesMFSurv")
```

## Functions


| Function |Description |
| ----------------- | -------------------------------------------------------------- | 
|`mfsurv`|fits a parametric Bayesian MF model via Markov Chain Monte Carlo (MCMC) to estimate the probability of misclassification in the first stage and the hazard in the second stage. Slice sampling is employed to draw the posterior sample of the model's split and survival stage parameters.|
|`mcmcsurv` | estimates a Bayesian Exponential or Weibull survival model via Markov Chain Monte Carlo (MCMC). Slice samplig is employed to draw the posterior sample of the model's survival stage parameters.|
|`stats`|a function to calculate the deviance information criterion (DIC) and the log-likelihood for fitted model objects of class mfsurv or mcmcsurv.|
|`summary`|returns a summary of a mfsurv or mcmcsurv object via `coda::summary.mcmc`.|





### Example


The data used to estimate the following examples come from Reenock, Bernhard and Sobek (2007) -DOI: 10.111/j.1468-2478.2007.00469.x-.  The RBS (2007) dataset uses continuous-time event history techniques to code episodes of democratic breakdown in all democracies from 1961 to 1995.  In addition, it provides data on a number of economic and political variables. 

|Variable| Description|
| ----------------- | -------------------------------------------------------------- | 
|__calinv__|inverse of per capita daily caloric supply|
|__lnlevel__|natural log of economic development|
|__calileve__|inverse of per capita daily caloric supply*lnlevel|
|__necon__|economic performance|
|__presi__|presidential regime|
|__tag__|effective number of parties|
|__rel__|religious fractionalization|
|__ethn__|ethnic fractionalization|
|__prevdem__|numbers of previous democratic episodes|
|__openc__|trade openness|
|__Y__|years in current democratic episode |
|__Y0__|years in current democratic episode (lagged)|
|__C__|breakdown of democratic episode|


#### Misclassified-Failure
```{r example, eval = FALSE}

# Baseline Bayesian misclassified failure (MF) model. 
# Misclassification stage only includes the intercept while the survival stage 
# includes all covariates described above.  

library(BayesMFSurv)

set.seed(95)
RBS <- na.omit(RBS)
Y   <- RBS$Y
X   <- as.matrix(cbind(1, RBS[,1:10]))
C   <- RBS$C
Z1  <- cbind(rep(1,nrow(RBS)))
Y0  <- RBS$Y0
model1 <- mfsurv(Y ~ X | C ~ Z1, Y0 = Y0,
                 N = 100000,
                 burn = 10000,
                 thin = 100,
                 w = c(0.5, .5, .5),
                 m = 20,
                 form = "Weibull",
                 na.action = 'na.omit')

```{r, echo = FALSE}
library(BayesMFSurv)
model1 <- rio::import(here::here("data-raw", "model1_output.rds"))
```

```{r}
stats(model1)

summary(model1, parameter = c("betas"))
```

#### Non Misclassified-Failure



```{r, eval = FALSE}
set.seed(95)
model2 <- mcmcsurv(Y = Y, Y0 = Y0, C =  C,  X = X, 
                   N = 15000, 
                   burn = 500, 
                   thin = 10, 
                   w = c(0.5, 0.5, 0.5),
                   m = 20, 
                   form = "Weibull")

```

```{r, echo = FALSE}
model2 <- rio::import(here::here("data-raw", "model2_output.rds"))
```


```{r}
stats(model2)

summary(model2, parameter = c("betas"))
```


```{r, echo = FALSE}
par(mfrow = c(3,4))
for(i in 1:ncol(model2$betas)){
    plot(density(model2$betas[,i]), main = i, ylab = "")}
par(mfrow = c(3,4))
for(i in 1:ncol(model2$betas)){plot(model2$betas[,i], type = 'l', ylab = "", xlab = "", main = i)}
```






#### Citation

To cite package`BayesMFSurv` in publications, please use:

```r
citation(package = 'BayesMFSurv')
```



